<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:a4j="http://richfaces.org/a4j" 
    xmlns:rich="http://richfaces.org/rich"
    template="/layout/template.xhtml">
    
    <ui:define name="title">
		<h:outputText value="#{msg['modulo']} - #{msg['empleados']} #{msg['nomina']}"/>
	</ui:define>
	
	<ui:define name="menuFrag">
		<rich:toolbarGroup id="tbgNominaQuincenal" location="right">
			<a4j:commandButton id="btnNominaQuincenal" styleClass="Titulo" style="cursor:pointer;"
				image="#{msg['subirDocumento22.img']}" title="#{msg['importar']} #{msg['nomina']} #{msg['quincenal']}"
				action="#{nominaAction.nuevaCargaNominaQuincenal}" 
				oncomplete="#{rich:component('pnlImportarNominaQuincenal')}.show()"
				render="pnlImportarNominaQuincenal"
				limitRender="true" />
		</rich:toolbarGroup>
	</ui:define>
	
	<ui:define name="body">
		<h:outputStylesheet library="css" name="rechum.css" />
		<h:outputScript library="scripts" name="rechum.js" />
		<h:outputScript library="scripts" name="nomina.js" />
		
			<a4j:poll id="pollNomina" interval="3000" 
				enabled="#{nominaAction.procesando}" 
				action="#{nominaAction.comprobarPeticion}" 
				oncomplete="procesoNomina(#{nominaAction.operacion}, #{nominaAction.tipoMensaje}, #{nominaAction.procesando}, '#{rich:clientId('pnlMensajes')}')"
				render="pollNomina,pnlMensajes #{not nominaAction.procesando ? (nominaAction.operacion ? ',statusNomina' : ',statusNomina,tagNotify') : ''}"
				limitRender="true" />
			
			<rich:notifyStack id="tagStack" position="topRight" direction="vertical" method="last" />
			<rich:notify id="tagNotify" stayTime="#{nominaAction.stayTime}" showShadow="false" showCloseButton="true" escape="false" 
				stack="tagStack" summary="#{msg['nomina']}" detail="#{nominaAction.mensaje}" />
			
			<div class="div_titulo" style="margin:50px auto 30px;">
				<h:outputText styleClass="Titulo" style="font-weight:bold; font-size:28px; color:#525252;"
					value="#{msg['empleados']} #{msg['nomina']}" />
			</div>
			
			<div class="div_pagina" style="margin: 20px 0 0;">
				<fieldset style="max-width:400px; margin:0 auto; padding:5px;">
					<a4j:region id="regionNomina">
						<h:panelGrid id="botonera" columns="2" style="padding:0; width:100%; min-width:450px; min-height:22px; text-align:left;">
							<h:panelGroup id="grupoBotonesIzquierdos" style="width:100%; vertical-align:middle; position:relative;">
								<h:panelGroup>
									<a4j:status id="statusNomina" for="regionNomina" >
										<f:facet name="start">
											<h:graphicImage value="#{msg['navegacion.loading.loading16.img']}" style="vertical-align: middle; position:relative;" />
											<h:outputLabel value="#{msg['procesando']}" style="cursor:pointer;"  styleClass="Titulo" />
										</f:facet> 
										
										<f:facet name="stop">
											<h:outputLabel value="#{msg['navegacion.label.vacio']}" style="cursor:pointer;"  styleClass="Titulo" />
										</f:facet>
										
										<f:facet name="success">
											<h:graphicImage value="#{msg['aplicar22.img']}" style="vertical-align: middle; position:relative;" />
											<h:outputLabel value="Proceso terminado" style="cursor:pointer;"  styleClass="Titulo" />
										</f:facet>
									</a4j:status>
								</h:panelGroup>
						
								<rich:messages id="validadorNomina" showDetail="false" showSummary="true" globalOnly="false" title="Campos requeridos!" >
									<f:facet name="errorMarker"><h:graphicImage value="#{msg['alert16.img']}" style="margin-right:1em; text-align:left;" /></f:facet>
								</rich:messages>
							</h:panelGroup>
							
							<h:panelGroup id="grupoBotonesDerechos" style="width:100%; vertical-align:middle; position:relative;">
								<a4j:commandButton id="cmdSalvar" style="float:right; margin-left: 5px; vertical-align:top; position:relative;"
									image="#{msg['aplicar22.img']}" title="#{msg['generar']} #{msg['nomina']}"
									action="#{nominaAction.salvar}" execute="@region"
									oncomplete="salvarNomina(#{nominaAction.operacion}, #{nominaAction.tipoMensaje}, '', '#{rich:clientId('pnlMensajes')}', '#{rich:clientId('pnlRecalcularNomina')}', #{rich:element('validadorNomina')});"
									render="panelFechas,validadorNomina,pnlRecalcularNomina,pnlMensajes,tagNotify,pollNomina"
									limitRender="true" />
							</h:panelGroup>
						</h:panelGrid>
						
						<h:panelGrid id="panelFechas" columns="2" columnClasses="colTitulo, colDato">
							<h:outputText value="#{msg['fecha']} #{msg['desde']}:" styleClass="Titulo" />
				            <rich:calendar id="txtFechaDesde" datePattern="dd/MMM/yyyy" enableManualInput="false"
				            	value="#{nominaAction.fechaDesde}"
								required="#{!empty param[rich:clientId('cmdSalvar')]}" 
								requiredMessage="#{msg['fecha']} #{msg['desde']} #{msg['mensaje.error.requerido']}">
								<a4j:ajax event="change" 
									listener="#{nominaAction.autoasignaFechaHasta}" 
									render="txtFechaHasta" limitRender="true" />
				            </rich:calendar>
							
							<h:outputText value="#{msg['fecha']} #{msg['hasta']}:" styleClass="Titulo" />
				            <rich:calendar id="txtFechaHasta" datePattern="dd/MMM/yyyy" enableManualInput="false"
				            	value="#{nominaAction.fechaHasta}"
								required="#{!empty param[rich:clientId('cmdSalvar')]}" 
								requiredMessage="#{msg['fecha']} #{msg['hasta']}  #{msg['mensaje.error.requerido']}" />
							
							<h:outputText value="#{msg['semanaObra']}:" styleClass="Titulo" />
							<h:outputText value="#{nominaAction.dowDesde} - #{nominaAction.dowHasta}" styleClass="Descripcion" /> 
							
							<h:outputText value="#{msg['listaRayaPreliminar']}:" styleClass="Titulo" />
		 					<h:selectBooleanCheckbox value="#{nominaAction.nominaPreliminar}" />
						</h:panelGrid>
					</a4j:region>
				</fieldset>
			</div>
		<a4j:log level="ALL" mode="popup" />
	</ui:define>
	
	<ui:define name="modals">
		<ui:include src="/modal/empleados/nomina/pnlMensajes.xhtml" />
		<ui:include src="/modal/empleados/nomina/pnlRecalcularNomina.xhtml" />
		<ui:include src="/modal/empleados/nomina/pnlImportarNominaQuincenal.xhtml" />
		<ui:include src="/modal/empleados/nomina/pnlEmpleadosSinProcesar.xhtml" />
	</ui:define>
</ui:composition>