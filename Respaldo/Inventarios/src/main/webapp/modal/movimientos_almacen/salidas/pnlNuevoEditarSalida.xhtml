<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:a4j="http://richfaces.org/a4j" 
    xmlns:rich="http://richfaces.org/rich">
    
    <rich:popupPanel id="pnlNuevoEditarSalida" autosized="true" domElementAttachment="form" style="min-width:800px; max-width:1024px;">
		<f:facet name="header">
			<h:outputText id="lblTitulo" value="#{msg['salidasAlmacen']}" styleClass="Titulo" style="margin-left:10px" />
		</f:facet>
		
		<f:facet name="controls">
			<h:graphicImage value="#{msg['navegacion.gral.cerrar.img']}" style="cursor:pointer;" onclick="#{rich:component('pnlNuevoEditarSalida')}.hide()" />
		</f:facet>
		
		<!-- BOTONERA -->
		<div id="botonera" style="display: block; width: 100%; height: 22px; margin-bottom: 1em;">
			<h:panelGroup id="grupoBotonesIzquierdos" style="width:100%">
				
			</h:panelGroup>
			
			<h:panelGroup id="grupoBotonesDerechos" style="width:100%">
				<h:panelGrid columns="2" style="float:right; margin-right:5px;" >
					<h:panelGroup style="vertical-align: middle; position:relative; ">
						<a4j:commandButton id="cmdSalvar" style="vertical-align: right; position:relative;"
							image="#{msg['salvar22.img']}" 
							disabled="#{!salidasAlmacenAction.puedeEditar}"
							onclick="#{rich:element('cmdSalvar')}.disabled = true;" 
							action="#{salidasAlmacenAction.guardar}"
							oncomplete="validaGuardarMovimiento( #{salidasAlmacenAction.operacionCompleta}, '#{rich:clientId('pnlMensajeErrorSalidas')}', '#{rich:clientId('pnlNuevoEditarSalida')}', '#{rich:clientId('pnlInfoReg')}',  #{rich:element('cmdSalvar')}, '#{rich:clientId('msgErrorSalida')}' );"
							render="dtSalidas, pnlMensajeErrorSalidas, msgErrorSalida"/>
					</h:panelGroup>
					
					<h:panelGroup style="vertical-align: middle; position:relative;">
						<a4j:status>
							<f:facet name="start"><h:graphicImage value="#{msg['navegacion.loading.loading16.img']}" style="vertical-align: middle; position:relative;"/></f:facet>
							<f:facet name="stop"> <h:graphicImage value="#{msg['navegacion.loading.loading_stop16.img']}" style="vertical-align: middle; position:relative;"/></f:facet>
						</a4j:status>
					</h:panelGroup>
				</h:panelGrid>
			</h:panelGroup>
		</div>
		
		<rich:messages id="msgErrorSalida" rendered="#{true}" showDetail="false" showSummary="true" globalOnly="false" title="Campos requeridos!" >
			<f:facet name="errorMarker"><h:graphicImage value="#{msg['alert16.img']}" style="margin-right:1em;" /></f:facet>
		</rich:messages>
		
		<h:panelGroup id="grupoDatos">
			<fieldset style="margin-top: 10px; margin-bottom: 10px">
				<legend>#{msg['datosGenerales']}</legend>
				
				<h:panelGrid columns="4" width="700" columnClasses="colTitulo,colDato" style="text-align:left;">
					<h:outputText value="#{msg['obra']}:" styleClass="Titulo"/>
					<a4j:commandLink id="cmdSeleccionarObra"
						immediate="true" 
						disabled="#{!salidasAlmacenAction.puedeEditar}"
						value="#{salidasAlmacenAction.pojoObra.id == null ? msg['seleccionar'] : salidasAlmacenAction.pojoObra.nombre }"  
						oncomplete="#{rich:component('pnlBusquedaObras')}.show();"  
						render="pnlBusquedaObrasPrincipal, rbTipoObraPrincipal, dtObras" />
				</h:panelGrid>
				
				<h:panelGrid columns="4" width="700" columnClasses="colTitulo,colDato,colTitulo,colDato" style="text-align:left;">
		            <h:outputText value="#{msg['almacen']}:" style="margin-left: 10px; margin-right: 0px" styleClass="Titulo"/>
					<h:selectOneMenu id="cboAlmacen" style="width:200px;" 
						disabled="#{!salidasAlmacenAction.puedeEditar}"
						value="#{salidasAlmacenAction.idAlmacen}">
						<f:selectItems value="#{salidasAlmacenAction.listaCboAlmacenes}" />
						<a4j:ajax event="change" 
							execute="@this" 
							oncomplete="validaCambioAlmacen( #{salidasAlmacenAction.numeroItems}, '#{rich:clientId('pnlAvisoCambioAlmacen')}', #{salidasAlmacenAction.almacenAnterior} );" />
					</h:selectOneMenu>
					
		            <h:outputText value="#{msg['entrega']}:" style="margin-left: 0px; margin-right: 0px" styleClass="Titulo" />
					<h:selectOneMenu style="width:200px; margin-left: 0px; margin-right: 0px" 
						disabled="#{!salidasAlmacenAction.puedeEditar}"
						value="#{salidasAlmacenAction.idEmpleadoEntrega}">
						<f:selectItems value="#{salidasAlmacenAction.listaCboEmpleadoEntrega}" /> 
					</h:selectOneMenu>
					
					<h:outputLabel value="#{msg['fecha']}:" style="margin-left: 10px; margin-right: 0px" styleClass="Titulo" />
		            <rich:calendar enableManualInput="true" 
		            	disabled="#{!salidasAlmacenAction.puedeEditar}"
		            	value="#{salidasAlmacenAction.fecha}"  
		            	required="#{!empty param[rich:clientId('cmdSalvar')]}"
						requiredMessage="#{msg['fecha']} #{msg['mensaje.error.requerido']}">
		                <rich:placeholder value="dd-MMM-yyyy" />
		            </rich:calendar>
		            
		            <h:outputText value="#{msg['recibe']}:" style="margin-left: 10px; margin-right: 0px" styleClass="Titulo" />
					<h:selectOneMenu style="width:200px;" 
						disabled="#{!salidasAlmacenAction.puedeEditar}"
						value="#{salidasAlmacenAction.idEmpleadoRecibe}">
						<f:selectItems value="#{salidasAlmacenAction.listaCboEmpleadoRecibe}" /> 
					</h:selectOneMenu>
				</h:panelGrid>
			</fieldset>
		</h:panelGroup>
		
		<h:panelGroup id="grupoDetalles">
			<fieldset style="margin-top: 10px; margin-bottom: 10px">
				<legend>#{msg['detalles']}</legend>
				
				<a4j:commandButton id="cmdAgregarProducto" style="float:right; vertical-align: middle; cursor: pointer; margin: 0 5px 10px 0;" 
					image="#{msg['agregar22.img']}" 
					rendered="#{salidasAlmacenAction.puedeEditar}"
					action="#{salidasAlmacenAction.validaCabeceraSalida}"
					oncomplete="validaCabeceraSalida( #{salidasAlmacenAction.operacionCompleta}, '#{rich:clientId('pnlMensajeErrorSalidas')}', '#{rich:clientId('pnlBusquedaProductos')}' );"
					render="pnlMensajeErrorSalidas, pnlBusquedaProductos">
					<rich:tooltip value="#{msg['agregar.e']}" styleClass="Descripcion" />
				</a4j:commandButton>
				
				<a4j:region >
					<rich:extendedDataTable value="#{salidasAlmacenAction.listaProductosSalida}" var="var"
						selection="#{salidasAlmacenAction.selection}" id="dtProductos" frozenColumns="1"
						cellpadding="0" cellspacing="0" rows="12"  border="0" rowClasses="Row1, Row2" styleClass="tabla_pagina"
		                selectionMode="single">
		                <a4j:ajax event="selectionchange" 
		                	listener="#{salidasAlmacenAction.selectionListener}"
		                	execute="@this" />
		                
		                <f:facet name="header">
						    <h:outputText value="#{msg['productos']}" />
						</f:facet>
						
						<rich:column width="100px" style="text-align:center;" styleClass="Titulo">
						    <f:facet name="header"><h:outputText value="#{msg['clave']}" /></f:facet>
						    <h:outputText value="#{var.producto.clave}"/>
						</rich:column>
						
						<rich:column width="350px">
						    <f:facet name="header"><h:outputText value="#{msg['descripcion']}" /></f:facet>
						    <h:outputText style="text-align: left;" value="#{var.producto.descripcion}" />
						</rich:column>
						
						<rich:column>
						    <f:facet name="header" styleClass="Titulo"><h:outputText value="#{msg['productos.um']}" /></f:facet>
						    <h:outputText value="#{var.producto.unidadMedida.valor}"/>
						</rich:column>
						
						<rich:column>
						    <f:facet name="header" styleClass="Titulo"><h:outputText value="#{msg['productos.cantidadEntregada']}" /></f:facet>
						    <h:inputText id="txtCantidadProducto" styleClass="textoCentrado"
						    	rendered="#{salidasAlmacenAction.puedeEditar}"   
						    	value="#{var.cantidad}"  >
						    	<a4j:ajax event="blur" 
						    		listener="#{salidasAlmacenAction.validaCantidadProducto}" 
						    		oncomplete="validaCantidadProducto( #{var.cantidad}, #{salidasAlmacenAction.cantidadProductoSeleccionado}, '#{rich:clientId('pnlAvisoCantidad')}', '#{rich:clientId('pnlAvisoCantidadCero')}' );" />
						    </h:inputText>
						    
						    <h:outputText rendered="#{!salidasAlmacenAction.puedeEditar}"
						    	value="#{var.cantidad}" />
						</rich:column>
						
						<rich:column>
						    <f:facet name="header" styleClass="Titulo"><h:outputText value="" /></f:facet>
						    <a4j:commandButton id="cmdEliminar" 
						    	image="#{msg['eliminar16.img']}"
								rendered="#{salidasAlmacenAction.puedeEditar}"
								oncomplete="#{rich:component('pnlMsgConfElimSalida')}.show()" 
								render="pnlMsgConfElimEntrada">
								<rich:tooltip showDelay="300" value="#{msg['cancelar']}" for="cmdEliminar" />
								<f:setPropertyActionListener target="#{salidasAlmacenAction.pojoMovimientoDetalleEliminar}" value="#{var}" />
							</a4j:commandButton>
						</rich:column>
						
		                <f:facet name="footer">
							<rich:dataScroller align="center" for="dtProductos" maxPages="10" ajaxSingle="true" page="#{salidasAlmacenAction.numPaginaOrdenCompra}" styleClass="Titulo" />
						</f:facet>
		            </rich:extendedDataTable>
				</a4j:region>
			</fieldset>
		</h:panelGroup>
	</rich:popupPanel>
</ui:composition>